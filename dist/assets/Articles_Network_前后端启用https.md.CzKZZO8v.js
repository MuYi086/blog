import{_ as s,o as i,c as a,a7 as t}from"./chunks/framework.CgLK9O2D.js";const e="/assets/https_step_1.BQ617wkZ.png",l="data:image/png;base64,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",y=JSON.parse('{"title":"前后端启用https","description":"","frontmatter":{"tags":["Network"]},"headers":[],"relativePath":"Articles/Network/前后端启用https.md","filePath":"Articles/Network/前后端启用https.md","lastUpdated":1719417334000}'),n={name:"Articles/Network/前后端启用https.md"},h=t('<h1 id="前后端启用https" tabindex="-1">前后端启用https <a class="header-anchor" href="#前后端启用https" aria-label="Permalink to &quot;前后端启用https&quot;">​</a></h1><h2 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-label="Permalink to &quot;背景&quot;">​</a></h2><p>自从 <code>chrome</code> 在2021年推出了 <code>HTTPS-First</code> 模式后, 访问不支持该协议的网站会显示整页预警，同时也驱动者互联网网站相继进行更迭。随着时代的进步，我们在开发环境也面临着更多的需求，比如调试诸多的第三方服务( <code>OAuth</code> 等),显然本地 <code>http</code> 已经不能满足了，于是我们建议在开发环境也引入 <code>https</code> ,除了方便开发调试,这样也能更好的模拟出真实线上环境.</p><h2 id="https介绍" tabindex="-1">HTTPS介绍 <a class="header-anchor" href="#https介绍" aria-label="Permalink to &quot;HTTPS介绍&quot;">​</a></h2><p><code>https</code> 协议指的是 <code>http + TLS</code> , 他之所以安全是因为传输过程中对数据进行了加密.</p><h2 id="对称算法和非对称算法" tabindex="-1">对称算法和非对称算法 <a class="header-anchor" href="#对称算法和非对称算法" aria-label="Permalink to &quot;对称算法和非对称算法&quot;">​</a></h2><p>对称算法: 能通过一个秘钥，双向加密和解密的算法称为对称算法(<code>RC2</code>, <code>Base64</code>) 非对称算法: 需要通过一对秘钥（公钥加密，私钥解密）加密和解密的算法称为非对称算法(<code>MD5</code>, <code>HASH</code> , <code>RSA</code>)</p><h2 id="https流程" tabindex="-1">HTTPS流程 <a class="header-anchor" href="#https流程" aria-label="Permalink to &quot;HTTPS流程&quot;">​</a></h2><ol><li>客户端下载服务端的数字证书(包含加密公钥)</li><li>客户端随机生成一个值(内容秘钥),通过数字证书中预设的公钥(传输公钥) 进行加密后传输给服务端</li><li>服务端接收到信息后，用(传输私钥) 进行解密获得内容秘钥.之后双方基于这个内容私钥通过对称算法进行内容的加密和解密(用对称算法的原因是因为开销小),传输还是通过非对称算法进行加密解密(性能开销大，但是更安全) 一般浏览器中会预置一些权威 <code>CA</code>（权威证书颁发机构）的证书，这样浏览器可以直接进行访问。如果是自己制作的证书那么会跳下面这个界面，需要信任后才能访问 <img src="'+e+'" alt="https warning" title="https warning"></li></ol><h2 id="证书制作" tabindex="-1">证书制作 <a class="header-anchor" href="#证书制作" aria-label="Permalink to &quot;证书制作&quot;">​</a></h2><p>一般而言，我们可以在域名服务商那里申请证书,但是有门槛和时间限制。为了方便，我们一般使用 <code>openssl</code> 或者 <code>cloudflare</code> 来申请证书. 请先参考如下文档 <a href="/Articles/Windows/安装Openssl.html">安装Openssl</a></p><ol><li><p>生成私钥</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> private_key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span></span></code></pre></div></li><li><p>用私钥生成证书申请文件</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca-req.csr</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> private_key.pem</span></span></code></pre></div></li><li><p>用私钥对申请文件签名生成证书</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca-req.csr</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca-cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -signkey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> private_key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -days</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3650</span></span></code></pre></div></li></ol><p>可以看到目录下已经生成三个文件 <img src="'+l+`" alt="证书" title="证书"></p><h2 id="后端启用https" tabindex="-1">后端启用https <a class="header-anchor" href="#后端启用https" aria-label="Permalink to &quot;后端启用https&quot;">​</a></h2><p>简单代码结构</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-7Wecc" id="tab-5rum7G1" checked><label for="tab-5rum7G1">app.js</label></div><div class="blocks"><div class="language-js vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Koa</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;koa&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 因为这里我使用的koa,为了更方便,使用了koa-sslify强制转换为https</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sslify</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;koa-sslify&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).default</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Koa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 读取私钥和证书</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sslOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  key: fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./server/ssl/private_key.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 私钥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cert: fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./server/ssl/ca-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 证书</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 接上面的sslify</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sslify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">https.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sslOptions, app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server running success at 3001&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div></div><h2 id="前端启用https" tabindex="-1">前端启用https <a class="header-anchor" href="#前端启用https" aria-label="Permalink to &quot;前端启用https&quot;">​</a></h2><p>参考 <code>Vite</code> 文档,先安装 <code>@vitejs/plugin-basic-ssl</code> , 然后配置在 <code>plugins</code> 里</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-oyEtu" id="tab-DENWvDL" checked><label for="tab-DENWvDL">vite.config.js</label></div><div class="blocks"><div class="language-js vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> basicSsl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@vitejs/plugin-basic-ssl&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    basicSsl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ol><li><a href="https://www.jianshu.com/p/86a92923c981" target="_blank" rel="noreferrer">koa-https</a></li><li><a href="https://www.albertaz.com/blog/nodejs-local-https" target="_blank" rel="noreferrer">node应用本地https</a></li><li><a href="https://www.leohuynh.dev/blog/use-https-in-local-development/" target="_blank" rel="noreferrer">How to create an HTTPS server in localhost</a></li><li><a href="https://cn.vitejs.dev/config/server-options.html#server-https" target="_blank" rel="noreferrer">Vite启用https</a></li></ol><div style="display:none;" data-pagefind-meta="base64:JTdCJTIydGFncyUyMiUzQSU1QiUyMk5ldHdvcmslMjIlNUQlMkMlMjJkYXRlJTIyJTNBMTcxOTQxNzMzNDAwMCU3RA=="></div>`,22),p=[h];function k(r,d,c,o,E,g){return i(),a("div",null,p)}const A=s(n,[["render",k]]);export{y as __pageData,A as default};
